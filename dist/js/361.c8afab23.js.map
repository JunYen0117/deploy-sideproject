{"version":3,"file":"js/361.c8afab23.js","mappings":"0tBAOA,MAAM,GAAEA,EAAE,QAAEC,IAAYC,EAAAA,EAAAA,KAIxB,IAAIC,EAAY,GAGhB,MAAMC,GAAUC,EAAAA,EAAAA,IAAI,IAEdC,GAAcC,EAAAA,EAAAA,KAAS,IACnB,gBAAeC,EAAMC,SAASL,EAAQK,UAK1CC,GAAWL,EAAAA,EAAAA,IAAI,IACfG,GAAQH,EAAAA,EAAAA,IAAI,OACZM,GAAON,EAAAA,EAAAA,IAAI,IACXO,GAAQP,EAAAA,EAAAA,IAAI,IACZQ,GAAWR,EAAAA,EAAAA,IAAI,IACfS,GAAcT,EAAAA,EAAAA,IAAI,IAClBU,GAASV,EAAAA,EAAAA,IAAI,IACbW,GAAOC,EAAAA,EAAAA,IAAS,CACpBT,QACAG,OACAC,QACAC,WACAC,cACAC,WAKFG,eAAeC,IACb,MAAMC,EAAQ,GACd,IACE,MAAMC,QAAgBC,EAAAA,EAAAA,KAAQC,EAAAA,EAAAA,IAAWvB,EAAI,aAC7CqB,EAAQG,SAASC,IACfC,QAAQC,IAAIF,EAAIT,QAChBI,EAAMQ,KAAKH,EAAII,GAAG,GAgBtB,CAdE,MAAOC,GACPJ,QAAQC,IAAI,QACd,CAAE,QAIqB,IAAjBP,EAAMW,SACRrB,EAASD,MAAQW,EAAMY,QAAO,CAACC,EAAKC,IAC3BA,EAAOD,EAAMC,EAAOD,GAC1B,GAGHzB,EAAMC,OAAS0B,SAASzB,EAASD,OAAS,GAAG2B,WAAWC,SAAS3B,EAASD,MAAMsB,OAAQ,KAE5F,CACF,CAGA,SAASO,IACPlC,EAAQK,MAAQN,EAAUoC,MAAM,GAAG5B,KACnC,MAAM6B,GAAaC,EAAAA,EAAAA,IAAYxC,EAASK,EAAYG,QAEpDiC,EAAAA,EAAAA,IAAYF,EAAYrC,EAAUoC,MAAM,IACrCI,MAAK,KACJjB,QAAQC,IAAI,SAAS,IAEtBiB,OAAM,KACLlB,QAAQC,IAAI,WAAW,IAExBgB,MAAK,KACJE,EAAOL,EAAW,GAExB,CAEA,SAASK,EAAQxC,GACf,MAAMmC,EAAanC,GACnByC,EAAAA,EAAAA,IAAeN,GACZG,MAAMI,IACLhC,EAAON,MAAQsC,EACfrB,QAAQC,IAAI,WAAW,IAExBiB,OAAM,KACLlB,QAAQC,IAAI,WAAW,IAExBgB,MAAK,KACJK,GAAW,GAEjB,CAEA9B,eAAe8B,IACb,UACQC,EAAAA,EAAAA,KAAOxB,EAAAA,EAAAA,IAAIzB,EAAI,WAAYQ,EAAMC,OAAQO,GAC/CU,QAAQC,IAAI,UAGZuB,IAGA/B,GAIF,CAHE,MAAOgC,GACPzB,QAAQC,IAAI,UACZZ,EAAON,MAAQ,EACjB,CACF,CAEA,SAASyC,IACPvC,EAAKF,MAAQ,GACbG,EAAMH,MAAQ,GACdI,EAASJ,MAAQ,GACjBK,EAAYL,MAAQ,GACpBM,EAAON,MAAQ,GACfN,EAAUM,MAAQ,EACpB,C,OAIA2C,EAAAA,EAAAA,KAAU,KACRjD,EAAYkD,SAASC,cAAc,SACnCnC,GAAa,I,o6BC3Hf,MAAMoC,EAAc,EAEpB,O","sources":["webpack://my-sideproject/./src/views/AddProduct.vue","webpack://my-sideproject/./src/views/AddProduct.vue?8891"],"sourcesContent":["<script setup>\r\n\r\nimport { dataBase } from '@/composables/db.js'\r\nimport { collection, doc, getDocs, setDoc } from 'firebase/firestore'\r\nimport { ref, reactive, computed, onMounted } from 'vue'\r\nimport { ref as firebaseRef, uploadBytes, getDownloadURL } from 'firebase/storage'\r\n\r\nconst { db, storage } = dataBase()\r\n\r\n// 變數常數：處理圖片--------------------------------------------\r\n// <input>欄位\r\nlet inputFile = ''\r\n// const imgSrc = ref('')\r\n// 要上傳的檔案名稱\r\nconst imgName = ref('')\r\n// sotrage路徑 = 指定資料夾路徑 + id + 檔案名稱\r\nconst storagePath = computed(() => {\r\n  return `products_img/${newId.value}/${imgName.value}`\r\n})\r\n// --------------------------------------------------------\r\n\r\n// 變數常數、處理資料----------------------------------------------\r\nconst latestId = ref('')\r\nconst newId = ref('001')\r\nconst name = ref('')\r\nconst price = ref('')\r\nconst category = ref('')\r\nconst description = ref('')\r\nconst imgUrl = ref('')\r\nconst data = reactive({\r\n  newId,\r\n  name,\r\n  price,\r\n  category,\r\n  description,\r\n  imgUrl\r\n})\r\n// ---------------------------------------------------\r\n\r\n// 函式-----------------------------------------------\r\nasync function getLatestId () {\r\n  const allId = []\r\n  try {\r\n    const allData = await getDocs(collection(db, 'products'))\r\n    allData.forEach((doc) => {\r\n      console.log(doc.data())\r\n      allId.push(doc.id)\r\n    })\r\n  } catch (error) {\r\n    console.log('取不到id')\r\n  } finally {\r\n    // 如果allId等於0，代表資料庫裡都沒資料\r\n    // 下方if程式碼全都不執行\r\n    // newId就是初始預設值 '001'\r\n    if (allId.length !== 0) {\r\n      latestId.value = allId.reduce((max, curr) => {\r\n        return curr > max ? curr : max\r\n      }, 0)\r\n\r\n      // 把 latestId + 1\r\n      newId.value = (parseInt(latestId.value) + 1).toString().padStart(latestId.value.length, '0')\r\n    }\r\n  }\r\n}\r\n\r\n// 執行upload() -> getURL() -> writeData()\r\nfunction upload () {\r\n  imgName.value = inputFile.files[0].name\r\n  const storageRef = firebaseRef(storage, storagePath.value)\r\n\r\n  uploadBytes(storageRef, inputFile.files[0])\r\n    .then(() => {\r\n      console.log('上傳圖片成功')\r\n    })\r\n    .catch(() => {\r\n      console.log('上傳圖片失敗了：')\r\n    })\r\n    .then(() => {\r\n      getURL(storageRef)\r\n    })\r\n}\r\n\r\nfunction getURL (ref) {\r\n  const storageRef = ref\r\n  getDownloadURL(storageRef)\r\n    .then((url) => {\r\n      imgUrl.value = url\r\n      console.log('取得圖片路徑成功')\r\n    })\r\n    .catch(() => {\r\n      console.log('取得圖片路徑失敗')\r\n    })\r\n    .then(() => {\r\n      writeData()\r\n    })\r\n}\r\n\r\nasync function writeData () {\r\n  try {\r\n    await setDoc(doc(db, 'products', newId.value), data)\r\n    console.log('上傳資料成功')\r\n\r\n    // 上傳成功就清空<input>欄位\r\n    clearInputValue()\r\n\r\n    // 取得新Id\r\n    getLatestId()\r\n  } catch (e) {\r\n    console.log('上傳資料失敗')\r\n    imgUrl.value = ''\r\n  }\r\n}\r\n\r\nfunction clearInputValue () {\r\n  name.value = ''\r\n  price.value = ''\r\n  category.value = ''\r\n  description.value = ''\r\n  imgUrl.value = '' // getURL()取得的圖片路徑\r\n  inputFile.value = ''\r\n}\r\n\r\n// ---------------------------------------\r\n\r\nonMounted(() => {\r\n  inputFile = document.querySelector('.file')\r\n  getLatestId()\r\n})\r\n//\r\n</script>\r\n\r\n<template>\r\n  <div class=\"container-fluid row\">\r\n    <div class=\"col-md-3\">\r\n      <NavBar></NavBar>\r\n    </div>\r\n    <div class=\"col-12 col-md-9\">\r\n      <form>\r\n        <label class=\"form-label\">id</label>\r\n        <input :value=\"data.newId\" type=\"text\" class=\"form-control\" disabled>\r\n        <label class=\"form-label\">名稱</label>\r\n        <input v-model=\"data.name\" type=\"text\" class=\"form-control\">\r\n        <label class=\"form-label\">價格</label>\r\n        <input v-model=\"data.price\" type=\"text\" class=\"form-control\">\r\n        <label class=\"form-label\">種類</label>\r\n        <input v-model=\"data.category\" type=\"text\" class=\"form-control\">\r\n        <label class=\"form-label\">詳情</label>\r\n        <textarea v-model=\"data.description\" class=\"form-control text_area\" style=\"height: 100px\"></textarea>\r\n        <label class=\"form-label\">上傳圖片</label>\r\n        <input type=\"file\" class=\"form-control file\">\r\n      </form>\r\n      <div>\r\n        <button @click=\"upload\" class=\"btn btn-dark d-block mt-3 fw-bold\">上傳</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n","import script from \"./AddProduct.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./AddProduct.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["db","storage","dataBase","inputFile","imgName","ref","storagePath","computed","newId","value","latestId","name","price","category","description","imgUrl","data","reactive","async","getLatestId","allId","allData","getDocs","collection","forEach","doc","console","log","push","id","error","length","reduce","max","curr","parseInt","toString","padStart","upload","files","storageRef","firebaseRef","uploadBytes","then","catch","getURL","getDownloadURL","url","writeData","setDoc","clearInputValue","e","onMounted","document","querySelector","__exports__"],"sourceRoot":""}